#!/bin/bash
# WebRTC VAD 検証スクリプト一括実行

echo "=============================================================================="
echo "WebRTC VAD 検証スクリプト 一括実行"
echo "=============================================================================="
echo ""

# 依存関係チェック
echo "📦 依存関係チェック..."
if python3 -c "import numpy, scipy, librosa, webrtcvad" 2>/dev/null; then
    echo "✓ すべての依存パッケージがインストール済み"
else
    echo "❌ 依存パッケージが不足しています"
    echo "以下のコマンドでインストールしてください:"
    echo "  pip install numpy scipy librosa webrtcvad"
    exit 1
fi

# 入力ファイルチェック
echo ""
echo "📂 入力ファイルチェック..."
if [ -f "/workspace/script1.wav" ]; then
    echo "✓ script1.wav が見つかりました"
    ls -lh /workspace/script1.wav
else
    echo "❌ script1.wav が見つかりません"
    echo "利用可能なWAVファイル:"
    find /workspace/DiaROS -name "*.wav" -type f | head -5
    exit 1
fi

echo ""
echo "=============================================================================="
echo "テスト 1/3: 100ms無声検出タイミング検証"
echo "=============================================================================="
python3 /workspace/test_webrtc_vad_timing.py

echo ""
echo ""
echo "=============================================================================="
echo "テスト 2/3: バッチ処理 vs ストリーミング処理"
echo "=============================================================================="
python3 /workspace/test_webrtc_batch_vs_stream.py

echo ""
echo ""
echo "=============================================================================="
echo "テスト 3/3: 最速設定（10msフレーム）での全フレーム出力"
echo "=============================================================================="
python3 /workspace/test_webrtc_fastest_streaming.py

echo ""
echo ""
echo "=============================================================================="
echo "すべてのテスト完了！"
echo "=============================================================================="
